<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TelegramWhite Admin</title>
    <style>
        :root {
            --primary: #0088cc;
            --bg: #0a0a0a;
            --card: #1a1a1a;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: monospace; background: var(--bg); color: white; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 10px; border-left: 4px solid var(--primary); }
        .online-users { margin-top: 20px; }
        .user-item { background: var(--card); padding: 10px; margin: 5px 0; border-radius: 5px; }
        .status-online { color: #00ff00; }
        .log { margin-top: 20px; }
        .log-entry { font-family: monospace; padding: 5px; border-bottom: 1px solid #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä TelegramWhite Admin Panel</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>üìà –°—Ç–∞—Ç—É—Å</h3>
                <p id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
            <div class="stat-card">
                <h3>üë• –û–Ω–ª–∞–π–Ω</h3>
                <p id="onlineCount">0</p>
            </div>
            <div class="stat-card">
                <h3>üí¨ –°–æ–æ–±—â–µ–Ω–∏–π</h3>
                <p id="messageCount">0</p>
            </div>
            <div class="stat-card">
                <h3>‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</h3>
                <p id="uptime">0s</p>
            </div>
        </div>
        
        <div class="online-users">
            <h3>üü¢ –û–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</h3>
            <div id="usersList"></div>
        </div>
        
        <div class="log">
            <h3>üìù –õ–æ–≥ —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10):</h3>
            <div id="messageLog"></div>
        </div>
    </div>

    <script>
        async function loadStats() {
            try {
                const response = await fetch('/admin');
                const data = await response.json();
                
                document.getElementById('status').innerHTML = 
                    `<span class="status-online">üü¢ ONLINE</span>`;
                document.getElementById('onlineCount').textContent = 
                    `${data.users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
                document.getElementById('messageCount').textContent = 
                    `${data.totalMessages} —Å–æ–æ–±—â–µ–Ω–∏–π`;
                document.getElementById('uptime').textContent = 
                    `${Math.floor(data.uptime)} —Å–µ–∫—É–Ω–¥`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = data.users.map(user => 
                    `<div class="user-item">üë§ ${user}</div>`
                ).join('');
                
            } catch (error) {
                document.getElementById('status').innerHTML = 
                    `<span style="color: red;">üî¥ OFFLINE</span>`;
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        loadStats();
        setInterval(loadStats, 5000);
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ WebSocket –¥–ª—è –ª–æ–≥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        const ws = new WebSocket(`ws://${location.host}`);
        const messageLog = document.getElementById('messageLog');
        
        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                if (data.type === 'new_message') {
                    const entry = document.createElement('div');
                    entry.className = 'log-entry';
                    entry.innerHTML = `
                        <strong>${data.username}:</strong> ${data.text}
                        <small style="color: #666;">(${new Date(data.timestamp).toLocaleTimeString()})</small>
                    `;
                    messageLog.prepend(entry);
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ª–æ–≥ 10 –∑–∞–ø–∏—Å—è–º–∏
                    if (messageLog.children.length > 10) {
                        messageLog.removeChild(messageLog.lastChild);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
            }
        };
        
        ws.onopen = () => {
            console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
        };
    </script>
</body>
</html>
